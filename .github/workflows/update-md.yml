name: Update Markdown File

on:
  push:
    paths: ['data/**']
  schedule:
    - cron: '0 */6 * * *'

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: pip install pyyaml  # nếu thực sự cần, hiện tại chưa dùng

      - name: Update MD
        run: |
          python - <<EOF
          import json
          import os

          # Ví dụ: nếu bạn có file data/data.json thật, thì dùng
          # Nếu chưa có, tạo data mẫu để test
          if not os.path.exists('data.json'):
              data = [{"name": "Example", "value": "123"}]
          else:
              with open('data.json', 'r') as f:
                  data = json.load(f)

          md_content = "# Cập nhật dữ liệu\n\n"
          for item in data:
              md_content += f"- {item.get('name', 'Unknown')}: {item.get('value', 'N/A')}\n"

          with open('README.md', 'w', encoding='utf-8') as f:
              f.write(md_content)

          EOF

          git config --global user.name 'github-actions[bot]'
          git config --global user.email '41898282+github-actions[bot]@users.noreply.github.com'
          git add README.md
          git commit -m "Auto update MD from data files" || echo "No changes to commit"
          git push || echo "Push failed (maybe no changes)"
